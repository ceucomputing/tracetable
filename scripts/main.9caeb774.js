SVGElement.prototype.getTransformToElement=SVGElement.prototype.getTransformToElement||function(a){return a.getScreenCTM().inverse().multiply(this.getScreenCTM())},String.prototype.endsWith||(String.prototype.endsWith=function(a,b){var c=this.toString();("number"!=typeof b||!isFinite(b)||Math.floor(b)!==b||b>c.length)&&(b=c.length),b-=a.length;var d=c.lastIndexOf(a,b);return-1!==d&&d===b}),window.parser=function(){function a(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function b(a,b,c,d,e,f){this.message=a,this.expected=b,this.found=c,this.offset=d,this.line=e,this.column=f,this.name="SyntaxError"}function c(a){function c(){return d(Qa).line}function d(b){function c(b,c,d){var e,f;for(e=c;d>e;e++)f=a.charAt(e),"\n"===f?(b.seenCR||b.line++,b.column=1,b.seenCR=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(b.line++,b.column=1,b.seenCR=!0):(b.column++,b.seenCR=!1)}return Ra!==b&&(Ra>b&&(Ra=0,Sa={line:1,column:1,seenCR:!1}),c(Sa,Ra,b),Ra=b),Sa}function e(a){Ta>Pa||(Pa>Ta&&(Ta=Pa,Ua=[]),Ua.push(a))}function f(c,e,f){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d,e,f,g=new Array(a.length);for(f=0;f<a.length;f++)g[f]=a[f].description;return d=a.length>1?g.slice(0,-1).join(", ")+" or "+g[a.length-1]:g[0],e=b?'"'+c(b)+'"':"end of input","Expected "+d+" but "+e+" found."}var i=d(f),j=f<a.length?a.charAt(f):null;return null!==e&&g(e),new b(null!==c?c:h(e,j),e,j,f,i.line,i.column)}function g(){var a,b;return a=Pa,b=h(),b!==y&&(Qa=a,b=B(b)),a=b}function h(){var b,c,d,f,g,h;if(b=Pa,c=j(),c!==y){if(d=[],f=Pa,g=[],10===a.charCodeAt(Pa)?(h=D,Pa++):(h=y,0===Va&&e(E)),h!==y)for(;h!==y;)g.push(h),10===a.charCodeAt(Pa)?(h=D,Pa++):(h=y,0===Va&&e(E));else g=C;if(g!==y?(h=j(),h!==y?(Qa=f,g=F(h),f=g):(Pa=f,f=C)):(Pa=f,f=C),f!==y)for(;f!==y;){if(d.push(f),f=Pa,g=[],10===a.charCodeAt(Pa)?(h=D,Pa++):(h=y,0===Va&&e(E)),h!==y)for(;h!==y;)g.push(h),10===a.charCodeAt(Pa)?(h=D,Pa++):(h=y,0===Va&&e(E));else g=C;g!==y?(h=j(),h!==y?(Qa=f,g=F(h),f=g):(Pa=f,f=C)):(Pa=f,f=C)}else d=C;if(d!==y){for(f=[],10===a.charCodeAt(Pa)?(g=D,Pa++):(g=y,0===Va&&e(E));g!==y;)f.push(g),10===a.charCodeAt(Pa)?(g=D,Pa++):(g=y,0===Va&&e(E));f!==y?(Qa=b,c=G(c,d),b=c):(Pa=b,b=C)}else Pa=b,b=C}else Pa=b,b=C;if(b===y)if(b=Pa,c=j(),c!==y){for(d=[],10===a.charCodeAt(Pa)?(f=D,Pa++):(f=y,0===Va&&e(E));f!==y;)d.push(f),10===a.charCodeAt(Pa)?(f=D,Pa++):(f=y,0===Va&&e(E));d!==y?(Qa=b,c=H(c),b=c):(Pa=b,b=C)}else Pa=b,b=C;return b}function i(){var b,c;for(b=[],32===a.charCodeAt(Pa)?(c=I,Pa++):(c=y,0===Va&&e(J));c!==y;)b.push(c),32===a.charCodeAt(Pa)?(c=I,Pa++):(c=y,0===Va&&e(J));return b}function j(){var b,c,d,f,g,h;return b=Pa,c=s(),c!==y?(d=i(),d!==y?(58===a.charCodeAt(Pa)?(f=K,Pa++):(f=y,0===Va&&e(L)),f!==y?(g=i(),g!==y?(h=k(),h!==y?(Qa=b,c=M(c,h),b=c):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C),b===y&&(b=k()),b}function k(){var b,c,d,f,g,h;return b=Pa,c=l(),c!==y?(d=i(),d!==y?(a.substr(Pa,2)===N?(f=N,Pa+=2):(f=y,0===Va&&e(O)),f!==y?(g=i(),g!==y?(h=s(),h!==y?(Qa=b,c=P(c,h),b=c):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C),b===y&&(b=l()),b}function l(){var b,c,d,f,g,h,j,k;return b=Pa,a.substr(Pa,5)===Q?(c=Q,Pa+=5):(c=y,0===Va&&e(R)),c!==y&&(Qa=b,c=S()),b=c,b===y&&(b=Pa,a.substr(Pa,3)===T?(c=T,Pa+=3):(c=y,0===Va&&e(U)),c!==y&&(Qa=b,c=V()),b=c,b===y&&(b=Pa,a.substr(Pa,5)===W?(c=W,Pa+=5):(c=y,0===Va&&e(X)),c!==y?(d=i(),d!==y?(f=t(),f!==y?(Qa=b,c=Y(f),b=c):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C),b===y&&(b=Pa,a.substr(Pa,6)===Z?(c=Z,Pa+=6):(c=y,0===Va&&e($)),c!==y?(d=i(),d!==y?(f=n(),f!==y?(Qa=b,c=_(f),b=c):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C),b===y&&(b=Pa,a.substr(Pa,6)===aa?(c=aa,Pa+=6):(c=y,0===Va&&e(ba)),c!==y?(d=i(),d!==y?(f=m(),f!==y?(g=i(),g!==y?(63===a.charCodeAt(Pa)?(h=ca,Pa++):(h=y,0===Va&&e(da)),h!==y?(j=i(),j!==y?(k=s(),k!==y?(Qa=b,c=ea(f,k),b=c):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C),b===y&&(b=Pa,a.substr(Pa,6)===fa?(c=fa,Pa+=6):(c=y,0===Va&&e(ga)),c!==y?(d=i(),d!==y?(f=t(),f!==y?(g=i(),g!==y?(61===a.charCodeAt(Pa)?(h=ha,Pa++):(h=y,0===Va&&e(ia)),h!==y?(j=i(),j!==y?(k=n(),k!==y?(Qa=b,c=ja(f,k),b=c):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)))))),b}function m(){var b,c,d,f,g,h;return b=Pa,c=n(),c!==y?(d=i(),d!==y?(61===a.charCodeAt(Pa)?(f=ha,Pa++):(f=y,0===Va&&e(ia)),f!==y?(g=i(),g!==y?(h=n(),h!==y?(Qa=b,c=ka(c,h),b=c):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C),b===y&&(b=Pa,c=n(),c!==y?(d=i(),d!==y?(60===a.charCodeAt(Pa)?(f=la,Pa++):(f=y,0===Va&&e(ma)),f!==y?(g=i(),g!==y?(h=n(),h!==y?(Qa=b,c=na(c,h),b=c):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C),b===y&&(b=Pa,c=n(),c!==y?(d=i(),d!==y?(62===a.charCodeAt(Pa)?(f=oa,Pa++):(f=y,0===Va&&e(pa)),f!==y?(g=i(),g!==y?(h=n(),h!==y?(Qa=b,c=qa(c,h),b=c):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C))),b}function n(){var a;return a=o(),a===y&&(a=u()),a}function o(){var b,c,d,f,g,h;return b=Pa,c=p(),c!==y?(d=i(),d!==y?(ra.test(a.charAt(Pa))?(f=a.charAt(Pa),Pa++):(f=y,0===Va&&e(sa)),f!==y?(g=i(),g!==y?(h=o(),h!==y?(Qa=b,c=ta(c,f,h),b=c):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C),b===y&&(b=p()),b}function p(){var b,c,d,f,g,h;return b=Pa,c=q(),c!==y?(d=i(),d!==y?(ua.test(a.charAt(Pa))?(f=a.charAt(Pa),Pa++):(f=y,0===Va&&e(va)),f!==y?(g=i(),g!==y?(h=p(),h!==y?(Qa=b,c=ta(c,f,h),b=c):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C),b===y&&(b=q()),b}function q(){var b,c,d,f,g,h;return b=r(),b===y&&(b=Pa,40===a.charCodeAt(Pa)?(c=wa,Pa++):(c=y,0===Va&&e(xa)),c!==y?(d=i(),d!==y?(f=o(),f!==y?(g=i(),g!==y?(41===a.charCodeAt(Pa)?(h=ya,Pa++):(h=y,0===Va&&e(za)),h!==y?(Qa=b,c=Aa(f),b=c):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C)):(Pa=b,b=C),b===y&&(b=t())),b}function r(){var b,c,d;if(Va++,b=Pa,c=[],Ca.test(a.charAt(Pa))?(d=a.charAt(Pa),Pa++):(d=y,0===Va&&e(Da)),d!==y)for(;d!==y;)c.push(d),Ca.test(a.charAt(Pa))?(d=a.charAt(Pa),Pa++):(d=y,0===Va&&e(Da));else c=C;return c!==y&&(Qa=b,c=Ea(c)),b=c,Va--,b===y&&(c=y,0===Va&&e(Ba)),b}function s(){var a,b;return a=Pa,b=v(),b!==y&&(Qa=a,b=Fa(b)),a=b}function t(){var a,b;return a=Pa,b=v(),b!==y&&(Qa=a,b=Ga(b)),a=b}function u(){var b,c,d,f;if(b=Pa,34===a.charCodeAt(Pa)?(c=Ha,Pa++):(c=y,0===Va&&e(Ia)),c!==y){for(d=[],Ja.test(a.charAt(Pa))?(f=a.charAt(Pa),Pa++):(f=y,0===Va&&e(Ka));f!==y;)d.push(f),Ja.test(a.charAt(Pa))?(f=a.charAt(Pa),Pa++):(f=y,0===Va&&e(Ka));d!==y?(34===a.charCodeAt(Pa)?(f=Ha,Pa++):(f=y,0===Va&&e(Ia)),f!==y?(Qa=b,c=La(d),b=c):(Pa=b,b=C)):(Pa=b,b=C)}else Pa=b,b=C;return b}function v(){var b,c,d;if(b=Pa,c=[],Ma.test(a.charAt(Pa))?(d=a.charAt(Pa),Pa++):(d=y,0===Va&&e(Na)),d!==y)for(;d!==y;)c.push(d),Ma.test(a.charAt(Pa))?(d=a.charAt(Pa),Pa++):(d=y,0===Va&&e(Na));else c=C;return c!==y&&(Qa=b,c=Oa(c)),b=c}var w,x=arguments.length>1?arguments[1]:{},y={},z={start:g},A=g,B=function(a){return{labels:Wa,vars:Xa,varsList:Ya,commands:a}},C=y,D="\n",E={type:"literal",value:"\n",description:'"\\n"'},F=function(a){return a},G=function(a,b){return[a].concat(b)},H=function(a){return[Xa,a]},I=" ",J={type:"literal",value:" ",description:'" "'},K=":",L={type:"literal",value:":",description:'":"'},M=function(a,b){return Wa[a]=c()-1,b},N="->",O={type:"literal",value:"->",description:'"->"'},P=function(a,b){return a.chain=b,a},Q="START",R={type:"literal",value:"START",description:'"START"'},S=function(){return{command:"START",title:"Start"}},T="END",U={type:"literal",value:"END",description:'"END"'},V=function(){return{command:"END",title:"End"}},W="INPUT",X={type:"literal",value:"INPUT",description:'"INPUT"'},Y=function(a){return{command:"INPUT",title:"INPUT "+a.title,code:a.code+'=tracetableInput("'+a.title+'")',"var":a.title}},Z="OUTPUT",$={type:"literal",value:"OUTPUT",description:'"OUTPUT"'},_=function(a){return{command:"OUTPUT",title:"OUTPUT "+a.title,code:"tracetableOutput("+a.code+")"}},aa="JUMPIF",ba={type:"literal",value:"JUMPIF",description:'"JUMPIF"'},ca="?",da={type:"literal",value:"?",description:'"?"'},ea=function(a,b){return{command:"JUMPIF",title:a.title+"?",condition:a.code,then:b}},fa="ASSIGN",ga={type:"literal",value:"ASSIGN",description:'"ASSIGN"'},ha="=",ia={type:"literal",value:"=",description:'"="'},ja=function(a,b){return{command:"ASSIGN",title:a.title+" = "+b.title,code:a.code+"="+b.code,"var":a.title}},ka=function(a,b){return{title:a.title+" = "+b.title,code:"("+a.code+")==("+b.code+")"}},la="<",ma={type:"literal",value:"<",description:'"<"'},na=function(a,b){return{title:a.title+" < "+b.title,code:"("+a.code+")<("+b.code+")"}},oa=">",pa={type:"literal",value:">",description:'">"'},qa=function(a,b){return{title:a.title+" > "+b.title,code:"("+a.code+")>("+b.code+")"}},ra=/^[+\-]/,sa={type:"class",value:"[+\\-]",description:"[+\\-]"},ta=function(a,b,c){return{title:a.title+" "+b+" "+c.title,code:a.code+b+c.code}},ua=/^[*\/]/,va={type:"class",value:"[*\\/]",description:"[*\\/]"},wa="(",xa={type:"literal",value:"(",description:'"("'},ya=")",za={type:"literal",value:")",description:'")"'},Aa=function(a){return{title:"("+a.title+")",code:"("+a.code+")"}},Ba={type:"other",description:"integer"},Ca=/^[0-9]/,Da={type:"class",value:"[0-9]",description:"[0-9]"},Ea=function(a){return{title:a.join(""),code:a.join("")}},Fa=function(a){return"label_"+a},Ga=function(a){return a in Xa||(Xa[a]=Ya.length,Ya.push(a)),{title:a,code:'tracetableScope["'+a+'"]'}},Ha='"',Ia={type:"literal",value:'"',description:'"\\""'},Ja=/^[a-zA-Z0-9 ]/,Ka={type:"class",value:"[a-zA-Z0-9 ]",description:"[a-zA-Z0-9 ]"},La=function(a){return{title:"'"+a.join("")+"'",code:'"'+a.join("")+'"'}},Ma=/^[a-zA-Z]/,Na={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},Oa=function(a){return a.join("")},Pa=0,Qa=0,Ra=0,Sa={line:1,column:1,seenCR:!1},Ta=0,Ua=[],Va=0;if("startRule"in x){if(!(x.startRule in z))throw new Error("Can't start parsing from rule \""+x.startRule+'".');A=z[x.startRule]}var Wa={},Xa={},Ya=[];if(w=A(),w!==y&&Pa===a.length)return w;throw w!==y&&Pa<a.length&&e({type:"end",description:"end of input"}),f(null,Ua,Ta)}return a(b,Error),{SyntaxError:b,parse:c}}(),$(function(){"use strict";function render(a,b){function c(a){var b=window.flowchart.parse(a);$("#diagram").empty(),b.drawSVG("diagram",{"line-length":25,flowstate:{current:{fill:"yellow","font-color":"red"}}})}function d(){var b="";if(0===tracetableItems.length)b+='<tr><td colspan="'+(a.varsList.length+1)+'">No items to display</td></tr>';else for(var c=0;c<tracetableItems.length;c++){b+="<tr>";for(var d=0;d<tracetableItems[c].length;d++)b+="<td>"+tracetableItems[c][d]+"</td>";b+="</tr>"}$("#tracetable > tbody").html(b)}var e,f,g=a.labels,h=a.commands,i="";for(e=0;e<h.length;e++){f=h[e];var j="operation";switch(f.command){case"JUMPIF":j="condition";break;case"START":j="start";break;case"END":j="end";break;case"INPUT":case"OUTPUT":j="inputoutput"}var k="";null!=b&&e===b&&(k="|current"),i+="node_"+e+"=>"+j+": "+f.title+k+"\n"}for(i+="\n",e=0;e<h.length;e++){f=h[e];var l=e<h.length-1?e+1:null,m="->";f.chain&&(l=g[f.chain],(f.chain.endsWith("_loop")||f.chain.endsWith("_right"))&&(m="(right)->"),f.chain.endsWith("_bottom")&&(m="(bottom)->")),l&&("JUMPIF"===f.command&&(m="(no)->"),i+="node_"+e+m+"node_"+l+"\n"),"JUMPIF"===f.command&&f.then&&(i+="node_"+e+"(yes)->node_"+g[f.then]+"\n")}c(i),d()}function execute(flowchart,current,callback){function updateTracetable(a){for(var b=[],c=vars[a],d=0;d<varsList.length+1;d++)b[d]=c===d?tracetableScope[a]:"";tracetableItems.push(b)}function tracetableInput(a){function b(c){if(null==c)callback(current,current);else{var d=parseInt(c);isNaN(d)?bootbox.prompt("Enter an integer value for "+a+":",b):(tracetableScope[a]=d,updateTracetable(a),callback(current,chain))}}b(0/0)}function tracetableOutput(a){for(var b=[],c=0;c<varsList.length;c++)b[c]="";b[varsList.length]=a,tracetableItems.push(b)}var labels=flowchart.labels,vars=flowchart.vars,varsList=flowchart.varsList,commands=flowchart.commands,command=commands[current],chain=current<commands.length-1?current+1:null;switch(command.chain&&(chain=labels[command.chain]),command.command){case"JUMPIF":var condition=eval(command.condition);condition&&(chain=labels[command.then]),callback(current,chain);break;case"INPUT":tracetableInput(command["var"]);break;case"ASSIGN":eval(command.code),updateTracetable(command["var"]),callback(current,chain);break;case"OUTPUT":eval(command.code),callback(current,chain);break;default:callback(current,chain)}}function resetTracetable(){var a=[];globalFlowchart&&(a=globalFlowchart.varsList);for(var b="<tr>",c=0;c<a.length;c++)b+="<th>"+a[c]+"</th>";b+="<th>OUTPUT</th></tr>",$("#tracetable > thead").html(b),tracetableItems=[]}function reset(){resetTracetable(),globalCurrent=0,execute(globalFlowchart,globalCurrent,function(a,b){globalCurrent=a,globalNext=b,render(globalFlowchart,globalCurrent),$("#next").prop("disabled",null==globalNext)})}var globalFlowchart=null,globalCurrent=0,globalNext=null,tracetableScope={},tracetableItems=[];if(""===window.location.search)$(".nav a").on("click",function(a){$.get($(a.target).data("src"),function(a){console.log(a),globalFlowchart=window.parser.parse(a),reset()})}),$(".nav a:first").click();else{$(".nav").hide();var data=deparam(window.location.search.slice(1)).f.replace(/\r\n/g,"\n");globalFlowchart=window.parser.parse(data),reset()}$("#next").on("click",function(){null!=globalNext&&($("#next").prop("disabled",!0),$("#reset").prop("disabled",!0),render(globalFlowchart,globalNext),execute(globalFlowchart,globalNext,function(a,b){globalCurrent=a,globalNext=b,render(globalFlowchart,globalCurrent),$("#next").prop("disabled",null==globalNext),$("#reset").prop("disabled",!1),null==globalNext&&bootbox.alert("Flowchart has ended. Select another flowchart or Reset to run again.")}))}),$("#reset").on("click",function(){reset()})});